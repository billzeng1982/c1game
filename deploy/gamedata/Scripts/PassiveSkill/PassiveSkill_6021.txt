--[[
����:����ǿ��
����:��������
����:���������Լ�������ֵ����<color=#f3bb25>������������ {1}��</color>
--]]
local ThisScriptId = 6021; 

--���ܵ�������
local function runBorn(LuaDataAgt)
		-- Ѫ������
		LuaDataAgt:SetFilter(FILTER_TYPE.HP, TARGET_GROUP.NONE, -1);
		--ȡ����������
		local PassiveSkillRatio = LuaDataAgt:GetPassiveSkillBaseValue(ThisScriptId,1);
						
		--���﹥ֵ
		local StrAtkAdd = 0;
		--�ӷ���ֵ
		local WitAtkAdd = 0;
		--������ֵ
		local StrDefAdd = 0;
		--�ӷ���ֵ
		local WitDefAdd = 0;
		--��Ѫ��ֵ
		local MaxHpAdd = 0;		
		
		--���﹥����
		local StrAtkRatio = 0;
		--�ӷ�������
		local WitAtkRatio = 0;
		--����������
		local StrDefRatio = 0;
		--�ӷ�������
		local WitDefRatio = 0;
		--��Ѫ������
		local MaxHpRatio = PassiveSkillRatio/100;			
		
		--�����ܸ���
		local DodgeChance = 0;
		--�Ӹ񵲸���
		local BlockChance = 0;
		--�����и���
		local HitChance = 0;
		--�ӱ�������
		local CriticalChance = 0;
		--�ӿ���������
		local AntiCriticalChance = 0;
		--�ӱ����˺�
		local CriticalRatio = 0;
		--�ӿ������˺�
		local AntiCriticalRatio = 0;
		--�Ӹ���ϵ��
		local BlockRatio = 0;
		--����ʵ�˺�
		local RealDmgPoint = 0;
		
		--����ά��Ѫ��
		local FinalAddStrAtk = math.floor(LuaDataAgt:GetStrAtk(VALUE_TYPE.ORIGIN_CONF) * StrAtkRatio + StrAtkAdd);
		LuaDataAgt:ChgStrAtk(VALUE_TYPE.CURRENT,FinalAddStrAtk);
		local FinalAddWitAtk = math.floor(LuaDataAgt:GetWitAtk(VALUE_TYPE.ORIGIN_CONF) * WitAtkRatio + WitAtkAdd);	
		LuaDataAgt:ChgWitAtk(VALUE_TYPE.CURRENT,FinalAddWitAtk);	
		local FinalAddStrDef = math.floor(LuaDataAgt:GetStrDef(VALUE_TYPE.ORIGIN_CONF) * StrDefRatio + StrDefAdd);
		LuaDataAgt:ChgStrDef(VALUE_TYPE.CURRENT,FinalAddStrDef);
		local FinalAddWitDef = math.floor(LuaDataAgt:GetWitDef(VALUE_TYPE.ORIGIN_CONF) * WitDefRatio + WitDefAdd);	
		LuaDataAgt:ChgWitDef(VALUE_TYPE.CURRENT,FinalAddWitDef);
		local FinalAddMaxHp = math.floor(LuaDataAgt:GetHp(VALUE_TYPE.RUNTIME_CONF) * MaxHpRatio + MaxHpAdd);
		LuaDataAgt:ChgHp(VALUE_TYPE.RUNTIME_CONF,FinalAddMaxHp,LuaDataAgt,VALUE_CHG_TYPE.CHG_HP_COMM, 0, 0);
		
		--�ӷǸ��ʲ���
		LuaDataAgt:ChgAttribute(VALUE_TYPE.CURRENT, ATTR_TYPE.ATTR_CHANCE_DODGE,DodgeChance);
		LuaDataAgt:ChgAttribute(VALUE_TYPE.CURRENT, ATTR_TYPE.ATTR_CHANCE_BLOCK,BlockChance);
		LuaDataAgt:ChgAttribute(VALUE_TYPE.CURRENT, ATTR_TYPE.ATTR_CHANCE_HIT,HitChance);		
		LuaDataAgt:ChgAttribute(VALUE_TYPE.CURRENT, ATTR_TYPE.ATTR_CHANCE_CRITICAL,CriticalChance);			
		LuaDataAgt:ChgAttribute(VALUE_TYPE.CURRENT, ATTR_TYPE.ATTR_CHANCE_ANTICRITICAL,AntiCriticalChance);			
		--�ӷǸ��ʲ���,��������ʵ�˺�ȡ������,���������м�ȡ�ܻ���
		LuaDataAgt:ChgAttribute(VALUE_TYPE.CURRENT, ATTR_TYPE.ATTR_CHANCE_CRITICAL_VALUE,CriticalRatio);		
		LuaDataAgt:ChgAttribute(VALUE_TYPE.CURRENT, ATTR_TYPE.ATTR_CHANCE_ANTICRITICAL_VALUE,AntiCriticalRatio);		
		LuaDataAgt:ChgAttribute(VALUE_TYPE.CURRENT, ATTR_TYPE.ATTR_CHANCE_BLOCK_VALUE,BlockRatio);			
		LuaDataAgt:ChgAttribute(VALUE_TYPE.CURRENT, ATTR_TYPE.ATTR_DAMAGEADD,RealDmgPoint);		

end

--���������ж�
local function checkCond(LuaDataAgt)
	return true;
end

--�Ҷ���,��������������ִ��
local function findTarget(LuaDataAgt)
	
end

--������Ч,��ֵ����
local function takeEffect(LuaDataAgt)
	if IsOnServer then
		LuaDataAgt:SetSkillEnable(false);
		return;
	end
	
	--LuaDataAgt:ChgHp(VALUE_TYPE.CURRENT,1000000,LuaDataAgt,VALUE_CHG_TYPE.CHG_HP_COMM, 0, 0);
	
	-- ����ʱ���ı�
	local RevivalTime = 0;
	LuaDataAgt:ChgRevivalTime(VALUE_TYPE.RUNTIME_CONF, -RevivalTime);
	
	--���ٶȱ���
	local   SpeedRatio = 0 + 1;
	LuaDataAgt:ChgSpeedByRatio(SpeedRatio);
	
	if not IsOnServer then
	    LuaDataAgt:RefreshFightNum();
	end
	
	-- ��������һ������ֻ��Чһ��
	LuaDataAgt:SetSkillEnable(false);
end

--���ܹ�ʽ
local function doFormula(LuaDataAgt, iFormulaType, iFormulaPara, rSource, rTarget, iDamageRef)
	
end

--Skill���˴���
local function doFilter(LuaDataAgt, iFilterType, rFilterOwner, FilterValue)
	-- Filter�������Ƿ��Ƿ�������
	local IsSource = rFilterOwner:Equal(FilterValue:GetSource());
		--[[		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_CITYBACK, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_CITYGATEBACK, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_CITYGATE, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_CITYWALL, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_TOWER, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_BARRIER, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_NORMAL, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_SHOOT, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_SPEAR, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_RUSH, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_FACE, 0, 0);
		LuaDataAgt:SetFormula(VALUE_CHG_TYPE.CHG_HP_ATK_AMBUSH, 0, 0);
		VALUE_CHG_TYPE.CHG_HP_GENERALSKILL]]
		
	local PassiveSkillRatio = LuaDataAgt:GetPassiveSkillBaseValue(ThisScriptId,1);
	
	-- ���������˺�,����Ϊ�˺�����
	local OutAll = 0; --���У�������դ��	
	local OutNormal = 0; --�ױ�
	local OutShoot = 0; --����
	local OutSpear = 0; --ǹ��
	local OutRush = 0; --ͻ��
	local OutFace = 0; --ӭ��
	local OutAmbush = 0; --����
	local OutCity = 0; --����
	local OutCityBack = 0; --��ǽ����
	local OutBarrier = 0; --��դ��,ֻ��������
	local OutSkill = 0; --����
	
	-- �������˺�,����Ϊ����
	local InAll = 0; --���У�������դ��		
	local InNormal = 0; --�ױ�
	local InShoot = 0; --����
	local InSpear = 0; --ǹ��
	local InRush = 0; --ͻ��
	local InFace = 0; --ӭ��
	local InAmbush = 0; --����
	local InCity = 0; --����
	local InCityBack = 0; --��ǽ����
	local InBarrier = 0; --դ��,ֻ��������	
	local InSkill = 0; --����
	
	--������������
	local OutCure = 0; --��������	
	local InCure = 0; --������

	if iFilterType == FILTER_TYPE.HP then
		--�����˺�����
		if IsSource and FilterValue.m_fFoo1 < 0 then
			--���У�������դ��	
			if not (FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_TOWER or
					FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_BARRIER) then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutAll);
			end		
			--�ױ�
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_NORMAL then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutNormal);
			end
			--����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_SHOOT then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutShoot);
			end
			--ǹ��
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_SPEAR then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutSpear);
			end
			--ͻ��
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_RUSH then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutRush);
			end
			--ӭ��
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_FACE then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutFace);
			end
			--����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_AMBUSH then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutAmbush);
			end
			--����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_CITYGATE or
				 FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_CITYWALL then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutCity);
			end
			--��ǽ����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_CITYBACK or
				 FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_CITYGATEBACK then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutCityBack);
			end
			--��դ��
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_TOWER or
				FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_BARRIER then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutBarrier);
			end
			--����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_GENERALSKILL then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + OutSkill);
			end

		end
		
		--���˺�����
		if not IsSource and FilterValue.m_fFoo1 < 0 then
			--���У�������դ��	
			if not (FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_TOWER or
					FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_BARRIER) then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InAll);
			end		
			--�ױ�
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_NORMAL then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InNormal);
			end
			--����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_SHOOT then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InShoot);
			end
			--ǹ��
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_SPEAR then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InSpear);
			end
			--ͻ��
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_RUSH then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InRush);
			end
			--ӭ��
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_FACE then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InFace);
			end
			--����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_AMBUSH then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InAmbush);
			end
			--����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_CITYGATE or
				 FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_CITYWALL then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InCity);
			end
			--��ǽ����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_CITYBACK or
				 FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_CITYGATEBACK then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InCityBack);
			end
			--��դ��
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_TOWER or
				FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_ATK_BARRIER then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InBarrier);
			end
			--����
			if FilterValue.m_iValueChgType == VALUE_CHG_TYPE.CHG_HP_GENERALSKILL then
				local iHp = FilterValue.m_fFoo1;
				FilterValue.m_fFoo1 = iHp * (1 + InSkill);
			end

		end
		--�������ƴ���
		if IsSource and FilterValue.m_fFoo1 > 0 then
			local iHp = FilterValue.m_fFoo1;
			FilterValue.m_fFoo1 = iHp * (1 + OutCure);
		end
		--�����ƴ���(�������Լ�������ʩ���ߵ�����)
		if not IsSource and FilterValue.m_fFoo1 > 0 then
			local iHp = FilterValue.m_fFoo1;
			FilterValue.m_fFoo1 = iHp * (1 + InCure);
		end
		
	end
	return FilterValue;
end

--����IDҪ�ͽű�ID����һ��
PassiveSkill_6021 = {
	func_runBorn = runBorn;
	func_checkCond = checkCond;
	func_findTarget = findTarget;
	func_takeEffect = takeEffect;
	
	func_doFormula = doFormula;
	func_doFilter = doFilter;
}