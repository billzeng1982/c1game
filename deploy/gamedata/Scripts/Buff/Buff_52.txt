--[[
名称：裸衣大战
类型：武将技能Buff
描述：嘲讽，加攻
--]]
local ThisScriptId = 52;

--Buff诞生处理
local function runBorn(LuaDataAgt)
	local source = LuaDataAgt:GetBuffSource();

	local itime = source:GetActiveSkillBaseValue(3);
	if source:IsHaveActiveSkillCheats(1) then     --秘籍1：增加时长
	    itime = itime * 1.1;
	end

	LuaDataAgt:SetBuffLifeTime(VALUE_TYPE.RUNTIME_CONF, itime);

	if not IsOnServer then
		LuaDataAgt:RefreshFightNum();
	end

	--设置过滤器
	LuaDataAgt:SetFilter(FILTER_TYPE.POS, TARGET_GROUP.NONE, 0);
end

--Buff驱散条件判断
local function checkDeadCond(LuaDataAgt)

	return false;
end

--Buff驱散生效
local function runDead(LuaDataAgt)
	--属性加减回退

	if not IsOnServer then
		LuaDataAgt:RefreshFightNum();
	end
end

--Buff生效条件判断
local function checkEffectCond(LuaDataAgt)
	return true;
end

--Buff生效
local function takeEffect(LuaDataAgt)
--[[
	--定时跟踪施法者
	local target = LuaDataAgt:GetBuffSource();
	local IsDead = target:IsDead();
	local IsRetreat = target:IsRetreat();
	if not IsDead and  not IsRetreat then
		local pos = target:GetCurPos();
		LuaDataAgt:MoveToDest(pos, false);
	end
--]]
end

--Buff过滤处理
local function doFilter(LuaDataAgt, iFilterType, rFilterOwner, FilterValue)
	-- Filter所有者是否是发起对象
	local IsSource = rFilterOwner:Equal(FilterValue:GetSource());

	if iFilterType == FILTER_TYPE.POS then
		-- 使用索敌系统来做嘲讽
		local buffSource = LuaDataAgt:GetBuffSource();

		if FilterValue.m_iValueChgPara == 1 then
			-- 跟踪系统，判断是不是相应目标
			if not LuaDataAgt:IsLockAttackTarget(buffSource) then
				-- 强制跟踪目标
				LuaDataAgt:LockAttackTarget(buffSource);
				-- 这次移动不生效
				FilterValue.m_iValueChgPara = 999;
			end
		else
			-- 非跟踪系统
			-- 强制跟踪目标
			LuaDataAgt:LockAttackTarget(buffSource);
			-- 这次移动不生效
			FilterValue.m_iValueChgPara = 999;
		end
	end

	return FilterValue;
end

Buff_52 = {
	func_runBorn = runBorn;
	func_checkDeadCond = checkDeadCond;
	func_runDead = runDead;
	func_checkEffectCond = checkEffectCond;
	func_takeEffect = takeEffect;
	func_doFilter = doFilter;
}