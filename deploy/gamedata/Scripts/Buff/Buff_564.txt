--[[
名称：白衣渡江
类型：武将技能Buff
描述：加速
--]]
local ThisScriptId = 564;

--Buff诞生处理
local function runBorn(LuaDataAgt)
	local source = LuaDataAgt:GetBuffSource();
	
	--buff时间设置
	local itime = source:GetActiveSkillBaseValue(2);
	if source:IsHaveActiveSkillCheats(2) then     --秘籍2：增加时长
		itime = itime * 1.1;
	end
	LuaDataAgt:SetBuffLifeTime(VALUE_TYPE.RUNTIME_CONF, itime);
	
	--加速
	local WitAtk = source:GetWitAtk(VALUE_TYPE.CURRENT);
	local Base = 100 ;
	local Ratio = 1 ;
	--local Base = source:GetActiveSkillBaseValue(1);
	--local Ratio = source:GetActiveSkillRateValue(1);
	local speed = Base + Ratio * WitAtk;
	
	if LuaDataAgt:Equal(source) and source:IsHaveActiveSkillCheats(1) then     --秘籍1：自身额外加速
	    speed = speed * 1.5 ;
	end
	
	LuaDataAgt:ChgSpeedByRatio(1 + speed / 100);
	
	if not IsOnServer then
		LuaDataAgt:RefreshFightNum();
	end
end

--Buff驱散条件判断
local function checkDeadCond(LuaDataAgt)
	
	return false;
end

--Buff驱散生效
local function runDead(LuaDataAgt)
    local source = LuaDataAgt:GetBuffSource();
	
	local WitAtk = source:GetWitAtk(VALUE_TYPE.CURRENT);
	local Base = 100 ;
	local Ratio = 1 ;
	--local Base = source:GetActiveSkillBaseValue(1);
	--local Ratio = source:GetActiveSkillRateValue(1);
	local speed = Base + Ratio * WitAtk;
	
	if LuaDataAgt:Equal(source)  and  source:IsHaveActiveSkillCheats(1) then     --秘籍1：自身额外加速
	    speed = speed * 1.5 ;
	end
	
	--移除加速
	LuaDataAgt:ChgSpeedByRatio(-1 - speed / 100);
	
	if not IsOnServer then
		LuaDataAgt:RefreshFightNum();
	end 
end

--Buff生效条件判断
local function checkEffectCond(LuaDataAgt)
	return true;
end

--Buff生效
local function takeEffect(LuaDataAgt)
	
end

Buff_564 = {
	func_runBorn = runBorn;
	func_checkDeadCond = checkDeadCond;
	func_runDead = runDead;
	func_checkEffectCond = checkEffectCond;
	func_takeEffect = takeEffect;
}